{% extends 'base.html' %}
{% block content %}

<div class="container-fluid px-2 px-md-4 py-4" style="background-color: #f8f9fa; min-height: 100vh;">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
    <h2 class="fs-4 fw-bold text-dark mb-0 d-flex align-items-center">
      <i class="bi bi-bar-chart-fill text-primary me-2 fs-4"></i> Sales Records
    </h2>
    <a href="{% url 'create_sale' %}" class="btn btn-gradient rounded-pill px-3 py-2">
      <i class="bi bi-plus-circle me-1"></i> Add Sale
    </a>
  </div>

  <div class="card shadow border-0 rounded-4 mx-auto" style="max-width: 100%;">
    <div class="card-header text-white fw-semibold fs-6 text-center py-3"
         style="background: linear-gradient(90deg, #6a11cb, #2575fc);">
      <i class="bi bi-clipboard-data-fill me-2"></i> Sales Overview
    </div>

    <div class="card-body p-0">
      <div class="table-responsive table-scroll-wrapper">
        <table class="table table-hover table-bordered align-middle text-center mb-0 border-dark" style="min-width: 1100px;">
          <thead class="table-light">
            <tr class="fw-semibold text-dark align-middle">
              <th>S.No</th>
              <th>Customer</th>
              <th>Phone</th>
              <th>Product</th>
              <th>Qty</th>
              <th>Price</th>
              <th>GST</th>
              <th>Discount</th>
              <th>Total</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for sale in sales %}
            <tr>
              <td>{{ forloop.counter }}</td>

              <td>
                {% if sale.customer %}
                  {{ sale.customer.name }}
                {% else %}
                  <span class="badge bg-secondary">Deleted Customer</span>
                {% endif %}
              </td>

              <td>{{ sale.phone|default:"—" }}</td>

              <td>
                {% if sale.product %}
                  {{ sale.product.name }}
                {% else %}
                  <span class="badge bg-secondary">Deleted Product</span>
                {% endif %}
              </td>

              <td>{{ sale.quantity_sold }}</td>
              <td>₹{{ sale.unit_price|floatformat:2 }}</td>
              <td>{{ sale.gst|floatformat:2 }}%</td>
              <td>{{ sale.discount|floatformat:2 }}%</td>
              <td class="fw-semibold text-success">₹{{ sale.total_price|floatformat:2 }}</td>

              <td>
                {% if sale.status == "Invoiced" %}
                  <span class="badge bg-success px-2 py-1">Invoiced</span>
                {% else %}
                  <span class="badge bg-warning text-dark px-2 py-1">Pending</span>
                {% endif %}
              </td>

              <td>
                <div class="d-flex justify-content-center gap-2">
                  <a href="{% url 'update_sale' sale.id %}" class="btn btn-sm btn-outline-primary rounded-circle shadow-sm" title="Edit">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <a href="{% url 'delete_sale' sale.id %}" class="btn btn-sm btn-outline-danger rounded-circle shadow-sm" title="Delete"
                     onclick="return confirm('Are you sure you want to delete this sale?');">
                    <i class="bi bi-trash"></i>
                  </a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="11" class="text-center text-muted py-4 fs-6">
                <i class="bi bi-cart-x-fill me-2 fs-5"></i> No sales found.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  .btn-gradient {
    background: linear-gradient(90deg, #6a11cb, #2575fc);
    color: white;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  .btn-gradient:hover {
    background: linear-gradient(90deg, #520dc2, #0056b3);
    box-shadow: 0 0 10px rgba(37,117,252,0.5);
    transform: translateY(-2px);
  }
  table { font-size: 0.9rem; }
  th, td { padding: 10px 12px !important; white-space: nowrap; border: 1px solid #343a40 !important; }
  .table-hover tbody tr:hover { background-color: #eef3ff; transition: all 0.2s ease; }
  .badge { font-size: 0.8rem; }
  .table-scroll-wrapper { overflow-x: auto; }
    }
  .table-scroll-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  max-width: 100%;
  padding-bottom: 4px;
}

.table-scroll-wrapper:hover {
  cursor: grab;
}

.table-scroll-wrapper:active {
  cursor: grabbing;
}
.table-scroll-wrapper {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
</style>
<script>
  const wrapper = document.querySelector('.table-scroll-wrapper');
  let isDown = false;
  let startX;
  let scrollLeft;

  wrapper.addEventListener('mousedown', (e) => {
    isDown = true;
    wrapper.classList.add('active');
    startX = e.pageX - wrapper.offsetLeft;
    scrollLeft = wrapper.scrollLeft;
  });

  wrapper.addEventListener('mouseleave', () => {
    isDown = false;
    wrapper.classList.remove('active');
  });

  wrapper.addEventListener('mouseup', () => {
    isDown = false;
    wrapper.classList.remove('active');
  });

  wrapper.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - wrapper.offsetLeft;
    const walk = (x - startX) * 1.5;
    wrapper.scrollLeft = scrollLeft - walk;
  });
</script>

{% endblock %}
